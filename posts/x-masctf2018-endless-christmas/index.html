<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
     
    <title>gi0cann&#39;s notes  | X-MasCTF 2018 RE: Endless Christmas</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
     <meta name="generator" content="Hugo 0.53" />
      
      
        <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
      

     <link href='https://gi0cann.io/dist/main.css' rel='stylesheet' type="text/css" />

     

      <meta property="og:title" content="X-MasCTF 2018 RE: Endless Christmas" />
<meta property="og:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall  Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &quot;fileXXXXXX&quot; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return  Running the chall binary generates 13 files and then prompts us for the flag." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gi0cann.io/posts/x-masctf2018-endless-christmas/" /><meta property="article:published_time" content="2018-12-30T21:08:42-04:00"/>
<meta property="article:modified_time" content="2018-12-30T21:08:42-04:00"/>

<meta itemprop="name" content="X-MasCTF 2018 RE: Endless Christmas">
<meta itemprop="description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall  Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &quot;fileXXXXXX&quot; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return  Running the chall binary generates 13 files and then prompts us for the flag.">


<meta itemprop="datePublished" content="2018-12-30T21:08:42-04:00" />
<meta itemprop="dateModified" content="2018-12-30T21:08:42-04:00" />
<meta itemprop="wordCount" content="281">



<meta itemprop="keywords" content="re,radare2,ctf," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="X-MasCTF 2018 RE: Endless Christmas"/>
<meta name="twitter:description" content="X-MasCTF 2018 RE: Endless Christmas We are given the &lsquo;chall&rsquo; file.
Running the file command shows us that it&rsquo;s a 64 bit ELF binary.
We proceed to open the file with radare2:
r2 -A chall  Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.
main retrieve argc store in local variable local_14h retrieve argv store in local variable local_20h store &quot;fileXXXXXX&quot; in local variable template call 4006a4(0x6b7ce0, 0x601080, 0xb6b21) 0x6b7ce0 - global variable empty 0x601080 - global variable pointing to string of chars call mkstemp(template) store return value in fildes = file descriptor call fchmod(fildes, 0x1ff) call write(fildes, 0x6b7ce0, 0x12c000) call fsync(fildes) call close(fildes) call execve(template, 0x0, 0x0) return  Running the chall binary generates 13 files and then prompts us for the flag."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://gi0cann.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      gi0cann&#39;s notes
    </a>
    <div class="flex-l items-center">
      
      







    </div>
  </div>
</nav>

    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <p class="f6 b helvetica tracked">
          POSTS
        </p>
        <h1 class="f1">
          X-MasCTF 2018 RE: Endless Christmas
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
        

<h1 id="x-masctf-2018-re-endless-christmas">X-MasCTF 2018 RE: Endless Christmas</h1>

<p>We are given the &lsquo;chall&rsquo; file.</p>

<p>Running the file command shows us that it&rsquo;s a 64 bit ELF binary.</p>

<p>We proceed to open the file with radare2:</p>

<pre><code>r2 -A chall
</code></pre>

<p><img src="chall-main.png" alt="chall-main" /></p>

<p>Looking at the main function we see that it creates and executes a file from the result of the function @ 0x4006a4.</p>

<h3 id="main">main</h3>

<pre><code>retrieve argc store in local variable local_14h
retrieve argv store in local variable local_20h
store &quot;fileXXXXXX&quot; in local variable template

call 4006a4(0x6b7ce0, 0x601080, 0xb6b21)
0x6b7ce0 - global variable empty
0x601080 - global variable pointing to string of chars

call mkstemp(template)
store return value in fildes = file descriptor

call fchmod(fildes, 0x1ff)

call write(fildes, 0x6b7ce0, 0x12c000)

call fsync(fildes)

call close(fildes)

call execve(template, 0x0, 0x0)

return
</code></pre>

<p>Running the chall binary generates 13 files and then prompts us for the flag.</p>

<p>We use the following python script to get the functions for all 13 files.</p>

<pre><code>import r2pipe
import os
import sys

bindir = os.listdir(sys.argv[1])

for binary in bindir:
    r2 = r2pipe.open(sys.argv[1] + &quot;/&quot; + binary)
    r2.cmd('aaa')
    functions = r2.cmdj('aflj')
    print binary
    for function in functions:
        print function.get('name')
    print &quot;&quot;

print &quot;Done!&quot;

</code></pre>

<p>Comparing the output of our python script shows that all the file have the same functions except for one.</p>

<p>We open the file in radare2 and disassemble the main function.</p>

<p><img src="final-main.png" alt="final-main" /></p>

<p>Looking a the disassembly we see that the main function takes our input and compares it to a constant after xor each character to that constant with 0xd.</p>

<p>We use a python script to extract the constant and xor to get the flag.</p>

<pre><code>import r2pipe
import sys


r2 = r2pipe.open(sys.argv[1])
r2.cmd('aaa')
flag = &quot;&quot;.join([chr(ord(i) ^ 0xd) for i in r2.cmd('ps @ 0x601060')])
print flag
</code></pre>

<pre><code>X-MAS{d3c0d3_4641n_4nd_4641n_4nd_4641n_4nd_4641n_4nd_fl46}
</code></pre>

      </div>
    </article>
    <aside class="ph3 mt2 mt6-ns">
      







  <div class="bg-light-gray pa3">
    <ul>
      <li class="list b mb3">
        1 More Posts
      </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/x-masctf2018-endless-christmas/" class="link ph2 pv2 db black o-50">
            X-MasCTF 2018 RE: Endless Christmas
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/x-masctf2018-our-christmas-wishlist/" class="link ph2 pv2 db black">
            X-MasCTF 2018 RE: Endless Christmas
          </a>
        </li>
      
    </ul>
  </div>


    </aside>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://gi0cann.io/" >
    &copy; 2018 gi0cann&#39;s notes
  </a>
  







  </div>
</footer>

    <script src="https://gi0cann.io/dist/app.bundle.js" async></script>

  </body>
</html>
